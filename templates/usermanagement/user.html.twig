{% extends 'partials/layout-vertical.html.twig' %}

{% block title %}Manage User
{% endblock %}

{% block css %}
	<!-- Datatables css -->
	<link href="/vendor/datatables.net-bs5/css/dataTables.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
	<link href="/vendor/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
	<link href="/vendor/datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
	<link href="/vendor/datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
	<link href="/vendor/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
	<link href="/vendor/datatables.net-select-bs5/css/select.bootstrap5.min.css" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block pagetitle %}
	{{ include('partials/page-title.html.twig', { sub_title: 'Manage User', page_title: 'Manage User' }) }}
{% endblock %}

{% block body %}

	<div class="row">
		<div class="col-xxl-12">
			<div class="row">
				{% for user in app.user %}
					<div class="col-md-3 mb-4">
						<div class="card text-center card-2">
							<div class="card-header border-0 pb-0">
								<div class="d-flex justify-content-between align-items-center">
									<h6 class="mb-0">
										<div class="badge bg-primary p-2 px-3 rounded">
											{{ user.type|capitalize }}
										</div>
									</h6>
								</div>
								{% if is_granted('edit user') or is_granted('delete user') %}
									<div class="card-header-right">
										<div class="btn-group card-option">
											{% if user.is_active == 1 %}
												<button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
													<i class="ti ti-dots-vertical"></i>
												</button>

												<div class="dropdown-menu dropdown-menu-end">

													{% if is_granted('edit user') %}
														<a href="#!" data-size="lg" data-url="{{ path('users.edit', {'id': user.id}) }}" data-ajax-popup="true" class="dropdown-item" data-bs-original-title="{{ 'Edit User' }}">
															<i class="ti ti-pencil"></i>
															<span>{{ 'Edit' }}</span>
														</a>
													{% endif %}

													{% if is_granted('delete user') %}
														{% set delete_form_id = 'delete-form-' ~ user.id %}
														<form method="POST" action="{{ path('users.destroy', {'id': user.id}) }}" id="{{ delete_form_id }}">
															<a href="#!" class="dropdown-item bs-pass-para">
																<i class="ti ti-archive"></i>
																<span>
																	{% if user.delete_status != 0 %}
																		{{ 'Delete' }}
																	{% else %}
																		{{ 'Restore' }}
																	{% endif %}
																</span>
															</a>
														</form>
													{% endif %}

													<a href="#!" data-url="{{ path('users.reset', {'id': user.id}) }}" data-ajax-popup="true" data-size="md" class="dropdown-item" data-bs-original-title="{{ 'Reset Password' }}">
														<i class="ti ti-adjustments"></i>
														<span>
															{{ 'Reset Password' }}</span>
													</a>
												</div>
											{% else %}
												<a href="#" class="action-item text-lg">
													<i class="ti ti-lock"></i>
												</a>
											{% endif %}
										</div>
									</div>
								{% endif %}
							</div>

							<div class="card-body full-card">
								<div class="img-fluid rounded-circle card-avatar">
									<img src="" class="img-user wid-80 round-img rounded-circle">
								</div>
								<h4 class="mt-3 text-primary">{{ user.name }}</h4>
								{% if user.delete_status == 0 %}
									<h5 class="office-time mb-0">{{ 'Soft Deleted' }}</h5>
								{% endif %}
								<small class="text-primary">{{ user.email }}</small>
								<p></p>
								<div class="text-center" data-bs-toggle="tooltip" title="{{ 'Last Login' }}">
									{{ user.last_login_at is not empty ? user.last_login_at : '' }}
								</div>
								{% if app.user.type == 'super admin' %}
									<div class="mt-4">
										<div class="row justify-content-between align-items-center">
											<div class="col-6 text-center">
												<span class="d-block font-bold mb-0">{{ user.currentPlan is not empty ? user.currentPlan.name : '' }}</span>
											</div>
											<div class="col-6 text-center Id">
												<a href="#" data-url="{{ path('plan.upgrade', {'id': user.id}) }}" data-size="lg" data-ajax-popup="true" class="btn btn-outline-primary" data-title="{{ 'Upgrade Plan' }}">{{ 'Upgrade Plan' }}</a>
											</div>
											<div class="col-12">
												<hr class="my-3">
											</div>
											<div class="col-12 text-center pb-2">
												<span class="text-dark text-xs">{{ 'Plan Expired : ' }}
													{{ user.plan_expire_date is not empty ? app.user.dateFormat(user.plan_expire_date) : 'Lifetime' }}</span>
											</div>
										</div>
									</div>

									<div class="row mt-3">
										<div class="col-12 col-sm-12">
											<div class="card mb-0">
												<div class="card-body p-3">
													<div class="row">
														<div class="col-4">
															<p class="text-muted text-sm mb-0" data-bs-toggle="tooltip" title="{{ 'Users' }}">
																<i class="ti ti-users card-icon-text-space"></i>
																{{ user.totalCompanyUser(user.id) }}</p>
														</div>
														<div class="col-4">
															<p class="text-muted text-sm mb-0" data-bs-toggle="tooltip" title="{{ 'Customers' }}">
																<i class="ti ti-users card-icon-text-space"></i>
																{{ user.totalCompanyCustomer(user.id) }}</p>
														</div>
														<div class="col-4">
															<p class="text-muted text-sm mb-0" data-bs-toggle="tooltip" title="{{ 'Vendors' }}">
																<i class="ti ti-users card-icon-text-space"></i>
																{{ user.totalCompanyVender(user.id) }}</p>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								{% endif %}
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>

	<!-- end row-->
{% endblock %}

{% block javascript %}
	<!-- Datatables js -->
	<script src="/vendor/datatables.net/js/jquery.dataTables.min.js"></script>
	<script src="/vendor/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
	<script src="/vendor/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
	<script src="/vendor/datatables.net-responsive-bs5/js/responsive.bootstrap5.min.js"></script>
	<script src="/vendor/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
	<script src="/vendor/datatables.net-buttons-bs5/js/buttons.bootstrap5.min.js"></script>
	<script src="/vendor/datatables.net-buttons/js/buttons.html5.min.js"></script>
	<script src="/vendor/datatables.net-buttons/js/buttons.flash.min.js"></script>
	<script src="/vendor/datatables.net-buttons/js/buttons.print.min.js"></script>
	<script src="/vendor/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
	<script src="/vendor/datatables.net-select/js/dataTables.select.min.js"></script>

	<!-- Datatable Demo Aapp js -->
	<script src="/js/pages/demo.datatable-init.js"></script>
{% endblock %}
